<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>The Bowling Lab</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    h4 {text-align: center}
    li {text-align: center}

    .center {
      display: block;
      margin-left: auto;
      margin-right: auto;
      width: 50%;
    }

    .youtube {
      margin-top: 40px;
      text-align: center;
    }
  </style>
</head>
<body><script src="https://apis.google.com/js/api.js"></script>
<script>
  const CLIENT_ID = '342271731749-d9g4kcrq57lip8g8qv4ijipdjpin7moe.apps.googleusercontent.com';
  const API_KEY = 'AIzaSyDt5OO6XrRuC_4YS72dwtHTFUp6OyDPPp0';
  const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest';
  const SCOPES = 'https://www.googleapis.com/auth/calendar.readonly';

  function gapiLoad() {
    gapi.load('client:auth2', initClient);
  }

  function initClient() {
    gapi.client.init({
      apiKey: API_KEY,
      clientId: CLIENT_ID,
      discoveryDocs: [DISCOVERY_DOC],
      scope: SCOPES,
    }).then(() => {
      const auth = gapi.auth2.getAuthInstance();
      if (!auth.isSignedIn.get()) {
        auth.signIn();
      }
    });
  }

  function getAvailability() {
    const availabilityResults = document.getElementById('availabilityResults');
    availabilityResults.innerHTML = '<p class="text-center">Loading available times...</p>';

    const dayStart = new Date('2025-05-07T08:00:00-04:00');
    const dayEnd = new Date('2025-05-07T18:00:00-04:00');

    const busy = [{ start: '2025-05-07T10:00:00-04:00', end: '2025-05-07T11:00:00-04:00' }];

    const slots = [];
    let current = new Date(dayStart);
    while (current < dayEnd) {
      const next = new Date(current.getTime() + 30 * 60 * 1000);
      const overlaps = busy.some(b => {
        return new Date(b.start) < next && new Date(b.end) > current;
      });
      if (!overlaps) {
        slots.push({ start: current.toISOString(), end: next.toISOString() });
      }
      current = next;
    }

    showAvailableSlots(slots);
  }

  function showAvailableSlots(slots) {
    const container = document.getElementById('availabilityResults');
    container.innerHTML = '<h5 class="text-center mb-3">Available Time Slots</h5>';
    const list = document.createElement('ul');
    list.className = 'list-group';

    if (slots.length === 0) {
      const msg = document.createElement('p');
      msg.className = 'text-center';
      msg.textContent = 'No available slots found.';
      container.appendChild(msg);
      return;
    }

    slots.forEach(slot => {
      const li = document.createElement('li');
      li.className = 'list-group-item text-center';
      li.textContent =
        new Date(slot.start).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) +
        ' - ' +
        new Date(slot.end).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      list.appendChild(li);
    });

    container.appendChild(list);
  }

  document.getElementById('checkAvailability').addEventListener('click', () => {
    const auth = gapi.auth2.getAuthInstance();
    if (auth.isSignedIn.get()) {
      getAvailability();
    } else {
      auth.signIn().then(() => getAvailability());
    }
  });

  gapiLoad();
</script>

</body>
</html>

